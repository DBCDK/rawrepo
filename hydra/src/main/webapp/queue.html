<!DOCTYPE html>
<!--
  ~ Copyright Dansk Bibliotekscenter a/s. Licensed under GNU GPL v3
  ~  See license text at https://opensource.dbc.dk/licenses/gpl-3.0
  -->

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Køpålæggelse</title>
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/3.6.0/superagent.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
</head>
<body>
<div id="webapp" class="container-fluid">
    <script>
        const e = React.createElement;

        class ProviderHelper extends React.Component {
            constructor(props) {
                super(props);
                this.getJsonFromUrl = this.getJsonFromUrl.bind(this);

                this.state = {
                    mode: 'validating', //validating -> analyzing -> confirming -> processing
                    params: this.getJsonFromUrl(),
                    validationResult: undefined
                };

                this.showStuff = this.showStuff.bind(this);
                this.showParams = this.showParams.bind(this);
                this.showValidation = this.showValidation.bind(this);
                this.showAnalysis = this.showAnalysis.bind(this);
                this.showProcessing = this.showProcessing.bind(this);

                this.getValidation = this.getValidation.bind(this);
                this.getAnalysis = this.getAnalysis.bind(this);
            }

            // This function extract the parameters from the url
            // Since react doesn't offer a neat way to do this we have to do it ourselves
            // Idea stolen from stackoverflow.com
            getJsonFromUrl() {
                let locationSplit = window.location.href.split('/');
                let params = locationSplit[locationSplit.length - 1];
                let query = params.split('?')[1];
                let result = {};
                query.split("&").forEach(function (part) {
                    let item = part.split("=");
                    result[item[0]] = decodeURIComponent(item[1]);
                });

                return result;
                //this.setState({params: result});
            }

            getValidation() {

            }

            getAnalysis() {

            }

            showStuff() {
                this.showParams();

                if (state.mode === 'validating') {
                    this.showValidation();
                }

                if (state.mode === 'analyzing') {
                    this.showValidation();
                    this.showAnalysis();
                }

                if (state.mode === 'confirming') {
                    this.showValidation();
                    this.showAnalysis();
                }

            }

            showParams() {

            }

            showValidation() {
                if (this.state.validationResult === undefined) {

                }
            }

            showAnalysis() {

            }

            showProcessing() {

            }

            render() {
                return e('div', null,
                    e('h1', {
                        id: 'h1-div-headline'
                    }, 'Køpålæggelse'),
                    e('hr'),
                    this.showStuff()
                );
            }
        }

        ReactDOM.render(
            e(ProviderHelper),
            document.getElementById('webapp')
        );
    </script>
</div>
</body>
</html>